<extend name="Public/base" />

<block name="style">
	<style>
		.dragsort {
		    width:400px;
		}
	</style>
</block>

<!-- 子导航 -->
<block name="sidebar">
	<include file="sidemenu" />
</block>

<block name="body">
	<script type="text/javascript" src="__STATIC__/uploadify/jquery.uploadify.min.js"></script>
	<!-- 标题栏 -->
	<div class="main-title cf">
		<h2><present name="goods">编辑<else />新增</present>商品</h2>
	</div>

	<!-- 修改密码表单 -->
	<form action="{:U('updateGoods')}" method="post" class="form-horizontal">
		<div class="form-item cf">
			<label class="item-label">商品名称</label>
			<div class="controls">
				<input type="text" value="{$goods.goods_name}" name="goods_name" class="text input-large">
			</div>
		</div>
		<div class="form-item cf">
			<label class="item-label">商品分类</label>
			<div class="controls">
				<select name="goods_type">
					<volist name="goodstypes" id="vo">
						<option value="{$vo.detail.cat_id}" <eq name="goods.goods_type" value="$vo.detail.cat_id"> selected</eq>>{$vo.detail.cat_name}</option>
						<volist name="vo.data" id="sub">
							<option value="{$sub.cat_id}" <eq name="goods.goods_type" value="$sub.cat_id"> selected</eq>>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$sub.cat_name}</option>
						</volist>
					</volist>
				</select>
			</div>
		</div>
		<div class="form-item cf">
			<label class="item-label">商品品牌</label>
			<div class="controls">
				<select name="goods_type">
					<volist name="brand" id="vo">
						<option value="{$vo.brand_id}" <eq name="goods.brand_id" value="$vo.brand_id"> selected</eq>>{$vo.brand_name}</option>
					</volist>
				</select>
			</div>
		</div>

		<div class="form-item cf">
			<label class="item-label">商品价格</label>
			<div class="controls">
				<input type="text" value="{$goods.shop_price}" name="shop_price" class="text input-large">
			</div>
		</div>

		<div class="form-item cf">
			<label class="item-label">商品图片</label>
			<div class="controls">
				<input type="file" id="upload_file_goods_img">
				<input type="hidden" name="goods_img" value="{$data['goods_img']}"/>
				<div class="upload-img-box">
					<present name="goods[goods_img]">
						<div class="upload-pre-item"><img src="__ROOT__{$data[$field['name']]|get_cover='path'}"/></div>
					</present>
				</div>
			</div>
			<script type="text/javascript">
				//上传图片
				/* 初始化上传插件 */
				$("#upload_file_goods_img").uploadify({
					"height"          : 30,
					"swf"             : "__STATIC__/uploadify/uploadify.swf",
					"fileObjName"     : "download",
					"buttonText"      : "上传附件",
					"uploader"        : "{:U('File/uploadPicture',array('session_id'=>session_id()))}",
					"width"           : 120,
					'removeTimeout'	  : 1,
					"onUploadSuccess" : uploadFilegoods_img,
				'onFallback' : function() {
					alert('未检测到兼容版本的Flash.');
				}
				});
				function uploadFilegoods_img(file, data){
					var data = $.parseJSON(data);
					if(data.status){
						var name = "goods_img";
						$("input[name="+name+"]").val(data.data);
						$("input[name="+name+"]").parent().find('.upload-img-box').html(
								"<div class=\"upload-pre-file\"><span class=\"upload_icon_all\"></span>" + data.info + "</div>"
						);
					} else {
						updateAlert(data.info);
						setTimeout(function(){
							$('#top-alert').find('button').click();
							$(that).removeClass('disabled').prop('disabled',false);
						},1500);
					}
				}
			</script>
		</div>

		<input type="hidden" name="id" value="{$goods.id}">
		<button type="submit" class="btn submit-btn ajax-post" target-form="form-horizontal">确 定</button>
		<button class="btn btn-return" onclick="javascript:history.back(-1);return false;">返 回</button>
	</form>
</block>

<block name="script">
	<present name="data">
		<script type="text/javascript" src="__STATIC__/jquery.dragsort-0.5.1.min.js"></script>
	</present>
	<script type="text/javascript">
		$(function(){
			//导航高亮
			highlight_subnav('{:U('goods/index')}');
		})
	</script>
</block>